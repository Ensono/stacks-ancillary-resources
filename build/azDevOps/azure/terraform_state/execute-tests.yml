name: "$(Build.SourceBranchName)-init"

pr:
  - master

schedules:
- cron: 0 */4 * * * # Run the infrastructure tests every 4 hours
  displayName: Execute InSpec Tests # friendly name given to a specific schedule
  branches:
    include:
      - main
  always: true

# Include the variables for this pipeline file
variables:
  - template: azdo-pipeline-vars.yml

stages:

  - stage: Tests

    jobs:
      - job: Inspec Tests
        pool:
          vmImage: $(pool_vm_image)

      - template: ../templates/infra-tests.yml
        parameters:
          CHEF_LICENSE: $(CHEF_LICENSE)
          TESTS_PATH: /app/src/terraform_state/tests/$(CLOUD_PLATFORM)